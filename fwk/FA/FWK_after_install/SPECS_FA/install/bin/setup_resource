#!/usr/bin/ksh
trap "" 23

ECHO=print

if [ `id -un` != "root" ]; then
    $ECHO "ERROR: You must log in as root."
    exit
fi

DEST=/opt/SPECS_FA

if grep -q "# For Agilent Technologies SPECS-FA" /etc/profile ||
   grep -q "# For Keysight Technologies SPECS-FA" /etc/profile; then
    $ECHO "        Already SPECS-FA environment variable for Bourne Shell existing. Not modify."
else
    $ECHO "        Set up SPECS-FA environment variables for Bourne Shell file."
    cat $DEST/sys/resource/home/etc/profile >> /etc/profile
fi

if [ `uname -s` = "HP-UX" ]; then
    if grep -q "# For Agilent Technologies SPECS-FA" /etc/csh.login ||
       grep -q "# For Keysight Technologies SPECS-FA" /etc/csh.login; then
        $ECHO "        Already SPECS-FA environment variable for C Shell existing. Not modify."
    else
        $ECHO "        Set up SPECS-FA environment variables for C Shell file."
        cat $DEST/sys/resource/home/etc/csh.login >> /etc/csh.login
    fi

    if [ -f /etc/dt/config/Xsession.d/3184.specsfaenv ]; then
        rm -f /etc/dt/config/Xsession.d/3184.specsfaenv
    fi
    if [ -d /etc/dt/config/Xsession.d ]; then
        cp $DEST/sys/resource/home/etc/3184.specsfaenv /etc/dt/config/Xsession.d
        chown bin:bin /etc/dt/config/Xsession.d/3184.specsfaenv
        chmod 555 /etc/dt/config/Xsession.d/3184.specsfaenv
    fi
else
    LSBRELEASE=/usr/bin/lsb_release
    RHEL_REL=-1
    if [ -x ${LSBRELEASE} ] ; then
        RHEL_REL=`${LSBRELEASE} -rs | sed 's/\..*//'`
    fi
    FALIB_CONF=/etc/ld.so.conf.d/SPECS_FA.conf
    DMHLIB=$DEST/dmh/lib

    if [ -f $FALIB_CONF ]; then
        echo "Already $FALIB_CONF existing. Not modify."
    else
        $ECHO $DMHLIB > $FALIB_CONF
        chmod 644 $FALIB_CONF
    fi

    if  [ ${RHEL_REL} -le 4 ]; then
        mv ${DMHLIB}/dmh84/libdmh84.so ${DMHLIB}/dmh84/libdmh84.so.org
        mv ${DMHLIB}/dmh84/libdmh84.el4.so.gz ${DMHLIB}/dmh84/libdmh84.so.gz
        gunzip ${DMHLIB}/dmh84/libdmh84.so.gz
    fi
    /sbin/ldconfig
fi

$DEST/install/bin/update_defaults -vgem -prober
$DEST/install/bin/cp_vgemfiles
$DEST/install/bin/cp_specsfiles
$DEST/install/bin/setup_symlink

cd $DEST
for spooldata in `find . -name spooldata.sql`; do
    chmod 666 $spooldata
done

if [ ! -d $DEST/sys/tmp ]; then
    mkdir $DEST/sys/tmp
fi
chown root:sys $DEST/sys/tmp
chmod 777 $DEST/sys/tmp
