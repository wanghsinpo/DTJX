#!/usr/bin/ksh
trap "" 23

ECHO=print
INSDIR=/opt/SPECS/install/bin
CFGDIR=/opt/SPECS/sys/config
ALGTYP=`sed -n '/^ALGTYPE=\(.*\)$/s/^ALGTYPE=\(.*\)$/\1/p' $CFGDIR/sysconf`
BALGDIR=/opt/SPECS/usr/alg
CALGDIR=/opt/SPECS/usr/calg
CNFUSR=`$INSDIR/get_user $CFGDIR/sysconf`
CNFGRP=`$INSDIR/get_group $CFGDIR/sysconf`

if [ `uname -s` = "HP-UX" ]; then
    SHLSFX="sl"
else
    SHLSFX="so"
fi

if [ `id -un` != "root" ]; then
    $ECHO "ERROR: You must log in as root."
    exit
fi

UTLNAM=UTIL_FA

$ECHO "Enter name of utility library to use and return return key."
$ECHO "Default = '$UTLNAM'. [skip='s'] : \c"
read UTLBUF
$ECHO

if [ "$UTLBUF" = "s" ]; then
    exit
elif [ "$UTLBUF" = "" ]; then
    UTLBUF=$UTLNAM
fi
UTLLIB=utility/$UTLBUF
if [ "$ALGTYP" = "BASIC" ]; then
    if [ ! -r $BALGDIR/$UTLLIB.lib ] || [ ! -r $BALGDIR/$UTLLIB.bas ]; then
        if [ -r $BALGDIR/$UTLBUF.lib -a -r $BALGDIR/$UTLBUF.bas ]; then
            UTLLIB=$UTLBUF
        else
            $ECHO "ERROR: Utility is not defined.  Customization canceled."
            exit
        fi
    fi
elif [ "$ALGTYP" = "C" ]; then
    if [ ! -r $CALGDIR/$UTLLIB.lib ] || [ ! -r $CALGDIR/$UTLLIB.$SHLSFX ]; then
        if [ -r $CALGDIR/$UTLBUF.lib -a -r $CALGDIR/$UTLBUF.$SHLSFX ]; then
            UTLLIB=$UTLBUF
        else
            $ECHO "ERROR: Utility is not defined.  Customization canceled."
            exit
        fi
    fi
fi

if [ ! -r $CFGDIR/sysconf.org ]; then
    cp -f $CFGDIR/sysconf $CFGDIR/sysconf.org             # keep original as .org
    chown $CNFUSR:$CNFGRP $CFGDIR/sysconf.org
    chmod 644 $CFGDIR/sysconf.org
fi
$INSDIR/update_sysconf

$ECHO "#### Customizing $CFGDIR/sysconf... ####"
sed    -e 's%^UTILLIB=.*$%UTILLIB='"$UTLLIB"'%' $CFGDIR/sysconf > $CFGDIR/sysconf.tmp
cp -f $CFGDIR/sysconf $CFGDIR/sysconf.bak                 # create backup as .bak
cp -f $CFGDIR/sysconf.tmp $CFGDIR/sysconf                 # update sysconf
rm -f $CFGDIR/sysconf.tmp
chown $CNFUSR:$CNFGRP $CFGDIR/sysconf
chmod 644 $CFGDIR/sysconf
$ECHO "        Previous sysconf was saved as sysconf.bak"
