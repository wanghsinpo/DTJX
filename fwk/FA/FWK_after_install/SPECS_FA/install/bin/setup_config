#!/usr/bin/ksh
trap "" 23

ECHO=print
SYSBIN="/opt/SPECS_FA/install/bin"
CFGDIR="/opt/SPECS/sys/config"

setup_env()
{
    $ECHO "==================== $title ===================="
    $ECHO "Type c (continue) or s (skip), then press Return."
    $ECHO "Default = 'c'. : \c"
    read seq

    if [ "$seq" = "" ]; then
        seq=c
    fi

    case $seq in
    c)    $SYSBIN/setup_env
          $ECHO; $ECHO;;
    s)    $ECHO;;
    *)    $ECHO "ERROR: Unknown character '$seq'.  Customization canceled."
          $ECHO;;
    esac
}
setup_recipe()
{
    $ECHO "==================== $title ===================="
    $ECHO "Type c (continue) or s (skip), then press Return."
    $ECHO "Default = 'c'. : \c"
    read seq

    if [ "$seq" = "" ]; then
        seq=c
    fi

    case $seq in
    c)    $SYSBIN/setup_recipe
          $ECHO; $ECHO;;
    s)    $ECHO;;
    *)    $ECHO "ERROR: Unknown character '$seq'.  Customization canceled."
          $ECHO;;
    esac
}

setup_userdisp()
{
    $ECHO "==================== $title ===================="
    $ECHO "Type c (continue) or s (skip), then press Return."
    $ECHO "Default = 'c'. : \c"
    read seq

    if [ "$seq" = "" ]; then
        seq=c
    fi

    case $seq in
    c)    $SYSBIN/setup_userdisp
          $ECHO; $ECHO;;
    s)    $ECHO;;
    *)    $ECHO "ERROR: Unknown character '$seq'.  Customization canceled."
          $ECHO;;
    esac
}

setup_eventmsgtype()
{
    $ECHO "==================== $title ===================="
    $ECHO "Type c (continue) or s (skip), then press Return."
    $ECHO "Default = 'c'. : \c"
    read seq

    if [ "$seq" = "" ]; then
        seq=c
    fi

    case $seq in
    c)    $SYSBIN/setup_eventmsgtype
          $ECHO; $ECHO;;
    s)    $ECHO;;
    *)    $ECHO "ERROR: Unknown character '$seq'.  Customization canceled."
          $ECHO;;
    esac
}

setup_ntp()
{
    $ECHO "==================== $title ===================="
    $ECHO "Type c (continue) or s (skip), then press Return."
    $ECHO "Default = 'c'. : \c"
    read seq

    if [ "$seq" = "" ]; then
        seq=c
    fi

    case $seq in
    c)    $SYSBIN/setup_ntp
          $ECHO; $ECHO;;
    s)    $ECHO;;
    *)    $ECHO "ERROR: Unknown character '$seq'.  Customization canceled."
          $ECHO;;
    esac
}

setup_license()
{
    $ECHO "==================== $title ===================="
    $ECHO "Type c (continue) or s (skip), then press Return."
    $ECHO "Default = 'c'. : \c"
    read seq

    if [ "$seq" = "" ]; then
        seq=c
    fi

    case $seq in
    c)    $SYSBIN/setup_license
          $ECHO; $ECHO;;
    s)    $ECHO;;
    *)    $ECHO "ERROR: Unknown character '$seq'.  Customization canceled."
          $ECHO;;
    esac
}

retry_setup()
{
    $ECHO "You can retry the $title."
    $ECHO "Type y (yes) or n (no), then press Return."
    $ECHO "Default = 'n'. : \c"

    while :; do
        read retry
        $ECHO

        if [ "$retry" = "" ]; then
            retry="n"
        fi

        if [ "$retry" = "y" ]; then
            break
        fi
        if [ "$retry" = "n" ]; then
            break
        fi
        $ECHO "Please answer 'y' or 'n' to retry. : \c"
    done

    $ECHO
}

exec_script()
{
    while :; do
        case $script in
        setup_env)   title="SPECS Environment Setup";;
        setup_recipe)   title="Recipe Files Setup";;
        setup_userdisp)  title="LMP User Data Display Area Setup";;
        setup_eventmsgtype)   title="Event Stream Function Setup";;
        setup_ntp)   title="Network Time Synchronization Setup";;
        setup_license)   title="License Setup";;
        esac

        $script
        if [ "$seq" = "s" ]; then
            break
        fi

        retry_setup
        if [ "$retry" = "n" ]; then
            break
        fi
    done
}

confirm()
{
    $ECHO "To use new files for the latest SPECS-FA revision such as VGEM csv"
    $ECHO "files, algorithm libraries, frameworks, facomcore and recipe files,"
    $ECHO "the files for earlier revision must be overwritten."
    $ECHO
    $ECHO "If you have already overwritten the files, continue this procedure."
    $ECHO "If you have not overwritten the files, and if you want to overwrite"
    $ECHO "the files, exit this procedure, then execute the following steps:"
    $ECHO
    $ECHO "  1. If needed, check that the files have been saved as different"
    $ECHO "     names for the backup."
    $ECHO "  2. # /opt/SPECS_FA/install/bin/cp_vgemfiles -F"
    $ECHO "  3. # /opt/SPECS_FA/install/bin/cp_specsfiles -F"
    $ECHO "  4. Execute the setup_config again."
    $ECHO
    $ECHO "Type c (continue) or q (quit), then press Return."
    $ECHO "Default = 'c'. : \c"
    read seq

    if [ "$seq" = "" ]; then
        seq=c
    fi

    case $seq in
    c)    $ECHO;;
    q)    exit;;
    *)    $ECHO "ERROR: Unknown character '$seq'.  Customization canceled."
          exit;;
    esac
}

$ECHO "==================================================================="
$ECHO "SPECS-FA System Configuration Setup..."
$ECHO "==================================================================="
$ECHO "System Configuration Setup..."
$ECHO "==================================================================="
$ECHO 

if [ `id -un` != "root" ]; then
    $ECHO "ERROR: You must log in as root."
    exit
else
    confirm

    script="setup_env"
    exec_script

    script="setup_recipe"
    exec_script
   
    script="setup_userdisp"
    exec_script
   
    script="setup_eventmsgtype"
    exec_script

    script="setup_ntp"
    exec_script
   
    script="setup_license"
    exec_script

fi
