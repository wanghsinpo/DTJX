#!/bin/sh
# restart \
exec dmh84 -f "$0" "$@"
# $Header: /usr/cvsroot/dmh84bin/dmh84_kill,v 1.1.1.1 2002/10/06 18:13:21 hume Exp $
# shutdown a DMH server
#
# $Log: dmh84_kill,v $
# Revision 1.1.1.1  2002/10/06 18:13:21  hume
# From previous version with ::dmh namespace and lset changes.
#
#
#
if { $argv == "" } {
    set name dmh_kill
    puts "$name - shutdown a DMH server"
    puts "Usage:  $name \[<hostname>:\]<groupname>"
    puts "For example:  $name doc:spc2"
    exit 1
    }

# connect to the server, or fail
set after_cmd ""
if { [info exists tk_library] } { 
     message .l -aspect 800 -text "Connecting to server $argv for shutdown... \
 \nIf you see this message, the server is not responding.  If the server\
 has just been started, the server may be waiting for its socket to become available,\
 and you should continue.  If the server is gone, you should cancel."

     button .b -text "Cancel" -command "exit 2"
     pack .l .b -side top -padx 5m -ipadx 2m -pady 5m
     wm withdraw .
     set after_cmd [after 2000 {catch {wm deiconify .}}]
     }

set group [::dmh::mbx init $argv]
if { $group == "" } { exit 2 }  ;# failure after timeout

# in the present design, the server does not have a command mailbox
# so use dp_RPC.  
::dmh::dp_RPC $::dmh::mh_server($group) eval {after 1 exit}
if { $after_cmd != "" } { after cancel $after_cmd }
exit 0
