<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML><HEAD>
<A NAME="srvany"></A>
<TITLE>Windows NT Tcl/Tk Service Installation</TITLE></HEAD>
<BODY>
<HR>
<P>
<H2>NAME</H2>
 srvany.exe - Microsoft utility to run dmh_wish.exe as a service<P>
<HR>
<P>
<H2>DESCRIPTION</H2>
<P>
The srvany.exe utility is distributed by Microsoft as part of their
Resource Kit for Windows NT.  Included with this utility is a Word
document, srvany.doc, and two utilities, Instsrv.exe, and Srvinstw.exe
that are used to install services.  A service is similar to
a background process on Unix.
<P>
The implications of running as a service include:
<UL>
<LI>The application can start with the system boot, without a user logon.
<LI>The application can stay running while users logon and logout.
<LI>The application can be configured to not interact with the user's display.
<LI>The application can use a different logon account with different security
credentials than the logged in user.
</UL>
<P>
You can install your own Tcl/Tk application to run as a service.  
One idea is to start a DMH server running that other applications
can connect to and use to start other processes.  This is similar
to an rexec demon.  You may find this example useful to start database
interfaces on remote machines.  The command message that you send to
start the database interface can specify a DMH message group
for the database interface to connect to.  
<P>
Here are the steps to configure a DMH startup service:
<OL>
<LI>Copy the <B>srvany.exe</B> program to a suitable directory on your
system such as c:\usr\local\bin.<P>
<LI>Install the srvany.exe program as a service using the Instsrv.exe
utility from the Microsoft resource kit.
<PRE>
  instsrv srvany c:\usr\local\bin\srvany.exe
</PRE>
<LI>
Now you specify parameters to the srvany service so it knows what application
to start and it knows what command line arguments to provide to the application.
You can specify the parameters by using <B>REGEDT32.EXE</B> following the directions
in <B>srvany.doc</B> or you can copy the
following information to a file such as "srvany.reg", edit it for your
circumstances, and double-click on it
from the Windows Explorer.  The file must end in the suffix ".reg" which 
Windows recognizes.  
<PRE>
REGEDIT4

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\srvany\Parameters]
"Application"="c:\\usr\\local\\bin\\dmh_wish.exe"
"AppParameters"="-f dmh84_server startup \"after 1 {mbx whenmsg startup_RPC mbx_RPC}\""
"AppDirectory"="c:\\usr\\local\\bin"
</PRE>
<LI>You can configure selected aspects of the service using the
Control Panel/Services applet.  The default installation creates a
service that will automatically start with the next reboot.
You can use the Control Panel to manually start now.<P>
<LI>You can show that the dmh_wish.exe process is running in several ways.<P>
<OL>
<LI>Right click on the Start bar and invoke the Task Manager....  You should
be able to see the dmh_wish.exe process running.<P>
<LI>Use <a href="dmh_inspect.html">inspect</a>, on the Target page, 
specify the DMH mailbox target 
as "startup_RPC@startup".  If you are on a different
computer, use "startup_RPC@<I>hostname</I>:startup" where <I>hostname</I>
is the hostname of the NT machine.  You will be inspecting the service
process.
</OL>
</OL>
<P>
With the service running, you can connect to it from another computer
and remotely start applications.  If you do not include the ampersand
&amp; background character on an exec command,  the startup server
will not respond to any more messages until the exec'd process finishes.
Usually you want to be sure to specify the ampersand.
<P>
For an example, we will startup a datahub, and then startup a database
interface on the remote NT machine which will connect to the datahub.
Suppose that the NT machine's hostname is office:
<UL>
<PRE>
dmh_wish
% exec datahub "set group=mbx" eof &
17329
{//c 0 SET:  Variable "server" set to "DATAHUB".}
{//c 0 SET:  Variable "group" set to "mbx".}
{//c 0 EOF:  Message system initialized, command mailbox is "DATAHUB@mbx"}
% mbx init office:startup
office:5788
% mbx whenmsg REPLYBOX {puts $mbxmsg ; mbx whenmsg again}
% mbx putr startup_RPC REPLYBOX [list exec dmh84_SQLsrv "set group=[dp_hostname]:mbx" \
 "set server=ENGDB" "connect Spc2 DBA SQL" &]
0 156
% mbx end
% exit
</PRE>
</UL>
<P>
<H2>KEYWORDS</H2>
 Windows NT, service, background, daemon
</BODY>
</HTML>
