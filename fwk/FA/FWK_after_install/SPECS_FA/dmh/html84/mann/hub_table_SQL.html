<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML><HEAD>
<TITLE>hub_table_SQL Tcl Command</TITLE></HEAD>
<BODY>
<HR>
<P>
<H2>NAME</H2>
 hub_table_SQL - obtain table data as SQL, optionally open safe subscription(s)<P>
<H2>SYNOPSIS</H2>
 <B>package require Humelib</B><BR>
 <B>hub_table_SQL <I>tablelist</I> {<I>want_reply</I> 1} {<I>want_send</I> 0} {<I>sendto_box</I> {}} {<I>subname</I> {}} {<I>submaxcount</I> 100}</B>
<HR>
<P>
<H2>DESCRIPTION</H2>
<P>
Use <b>hub_table_SQL</b> to obtain the table create statement and current data of a table (or tables)
as a list of SQL statements.  The command can optionally open a subscription to future
changes.  The data is read and the subscription is established without 
possible intervening change of the table data.  
<P>
When a subscription is opened, 
the functionality is similar to opening a data subscription using the 
CREATE and SYNC options, but the efficiency can be greater since the create
statement and current data is obtained as one large message instead of
a flurry of small SQL messages.  Also, the command integrates use of the
<A href="hub_safe_sub.html">hub_safe_sub_set</A> command to provide safety
checking for runaway subscriptions.
<P>
There is an option to obtain the SQL statements as a returned result, or
to have it sent as the first message to a specified mailbox.
<P>
Command arguments:
<DL>
<DT><I>tablelist</I>
<DD>One of more SQL table names.
<DT><I>want_reply</I>
<DD>If 1, a list of SQL statements is the return value of the procedure.  Defaults to 1.
If 0, the return value of the procedure is:
<OL>
<LI>if subscriptions are opened, the reply from opening the last subscription
<LI>else if <I>want_send</I> is true, the message, "data sent to $sendto_box"
<LI>else the message, "no observable output!"
</OL>
<DT><I>want_send</I>
<DD>If 1, data is sent to the <I>sendto_box</I> as one big message in a format 
that is compatible with the usual processing of DMH messages as SQL commands.
Defaults to 0.
<DT><I>subname</I>
<DD>Optionally, a unique name for the subscription(s), if a subscription is to be opened.
The default value of an empty string means that subscriptions are not opened.
<DT><I>sendto_box</I>
<DD>Optionally, a mailbox name for the current data and/or
the subscription messages if a subscription is to be opened.
This should be a mailbox that handles received messages as SQL commands.  
An example mailbox setup would be, <blockquote>"mbx whenmsg MYBOX_SQL mbx_SQL"</blockquote>
Running the hub application script is also a means of setting up
a mailbox to process received messages as SQL commands.
<DT><I>submaxcount</I>
<DD>If both <I>subname</I> and <I>sendto_box</I> values are non-blank a subscription is opened.
The hub_safe_sub logic is used to close the subscription if greater than
an expected number of messages are seen in the mailbox during a polling check.
The optional argument, <I>submaxcount</I>, can set the limit.
</DL>

<P>
The command is part of the <B>Humelib</B> package and it exists
in the global namespace.
<H2>EXAMPLE</H2>
<PRE>
# at the server process
package require Humelib

  # at the client process
  if { ![hub_table_exists dc_user] } {
      set tablelist {dc_user dc_user_group dc_user_privilege}
      set cmd [list eval hub_table_SQL $tablelist 1 0 $dc_ui(MB_SQL) $dc_ui(MB_SQL)]
      # this gives us the existing data as an efficient big reply
      # and opens subscriptions for future changes
      # and also registers us for safe subscription checking
      set reply [dc_ui_hub_xact $cmd $dc_ui(dmh)]
      foreach stmt $reply { SQL $stmt }
      mbx whenmsg $dc_ui(MB_SQL) mbx_SQL
      }

</PRE>
<H2>AUTHOR</H2>
 Hume Integration Software, www.hume.com  <P>
<H2>SEE ALSO</H2>
 <a href="../mann/mbx.html">DMH</A>&nbsp;
 <a href="../mann/hub_safe_sub.html">hub_safe_sub_set</A>&nbsp;
 <a href="../man1/datahub.html#OPEN">SQL open</A>&nbsp;
 <a href="../man1/datahub.html#SELECT">SQL select</A>
<H2>KEYWORDS</H2>
 datahub, DMH, open, select, subscription
</BODY>
</HTML>
