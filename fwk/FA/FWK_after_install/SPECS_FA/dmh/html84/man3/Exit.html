<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML><HEAD>
<A NAME="Tcl_Exit_Tcl_8_1"></A>
<TITLE>Tcl_Exit Tcl Library Procedures 8.1</TITLE></HEAD>
<BODY>
<HR>
<P>
<H2>NAME</H2>
 Tcl_Exit, Tcl_Finalize, Tcl_CreateExitHandler, Tcl_DeleteExitHandler, Tcl_ExitThread, Tcl_FinalizeThread, Tcl_CreateThreadExitHandler, Tcl_DeleteThreadExitHandler - end the application or thread (and invoke exit handlers) <P>
<H2>SYNOPSIS</H2>
 
<B>#include &lt;tcl.h&gt;</B>
<P>
<B>Tcl_Exit</B>(<I>status</I>)
<P>
<B>Tcl_Finalize</B>()
<P>
<B>Tcl_CreateExitHandler</B>(<I>proc, clientData</I>)
<P>
<B>Tcl_DeleteExitHandler</B>(<I>proc, clientData</I>)
<P>
<B>Tcl_ExitThread</B>(<I>status</I>)
<P>
<B>Tcl_FinalizeThread</B>()
<P>
<B>Tcl_CreateThreadExitHandler</B>(<I>proc, clientData</I>)
<P>
<B>Tcl_DeleteThreadExitHandler</B>(<I>proc, clientData</I>)
<P>
<H2>ARGUMENTS</H2>

<P><DT><B>int <I>status</I></B> (in)
<DD>Provides information about why the application or thread exited.
Exact meaning may
be platform-specific.  0 usually means a normal exit, any nonzero value
usually means that an error occurred.
<P><DT><B>Tcl_ExitProc <I>*proc</I></B> (in)
<DD>Procedure to invoke before exiting application.
<P><DT><B>ClientData <I>clientData</I></B> (in)
<DD>Arbitrary one-word value to pass to <I>proc</I>.
<HR>
<P>
<P>
<H2>DESCRIPTION</H2>

<P>
The procedures described here provide a graceful mechanism to end the
execution of a <B>Tcl</B> application. Exit handlers are invoked to cleanup the
application's state before ending the execution of <B>Tcl</B> code.
<P>
Invoke <B>Tcl_Exit</B> to end a <B>Tcl</B> application and to exit from this
process. This procedure is invoked by the <B>exit</B> command, and can be
invoked anyplace else to terminate the application.
No-one should ever invoke the <B>exit</B> system procedure directly;  always
invoke <B>Tcl_Exit</B> instead, so that it can invoke exit handlers.
Note that if other code invokes <B>exit</B> system procedure directly, or
otherwise causes the application to terminate without calling
<B>Tcl_Exit</B>, the exit handlers will not be run.
<B>Tcl_Exit</B> internally invokes the <B>exit</B> system call, thus it never
returns control to its caller.
<P>
<B>Tcl_Finalize</B> is similar to <B>Tcl_Exit</B> except that it does not
exit from the current process.
It is useful for cleaning up when a process is finished using <B>Tcl</B> but
wishes to continue executing, and when <B>Tcl</B> is used in a dynamically
loaded extension that is about to be unloaded.
On some systems <B>Tcl</B> is automatically notified when it is being
unloaded, and it calls <B>Tcl_Finalize</B> internally; on these systems it
not necessary for the caller to explicitly call <B>Tcl_Finalize</B>.
However, to ensure portability, your code should always invoke
<B>Tcl_Finalize</B> when <B>Tcl</B> is being unloaded, to ensure that the
code will work on all platforms. <B>Tcl_Finalize</B> can be safely called
more than once.
<P>
<B>Tcl_ExitThread</B> is used to terminate the current thread and invoke
per-thread exit handlers.  This finalization is done by
<B>Tcl_FinalizeThread</B>, which you can call if you just want to clean
up per-thread state and invoke the thread exit handlers.
<B>Tcl_Finalize</B> calls <B>Tcl_FinalizeThread</B> for the current
thread automatically.
<P>
<B>Tcl_CreateExitHandler</B> arranges for <I>proc</I> to be invoked
by <B>Tcl_Finalize</B> and <B>Tcl_Exit</B>.
<B>Tcl_CreateThreadExitHandler</B> arranges for <I>proc</I> to be invoked
by <B>Tcl_FinalizeThread</B> and <B>Tcl_ExitThread</B>.
This provides a hook for cleanup operations such as flushing buffers
and freeing global memory.
<I>Proc</I> should match the type <B>Tcl_ExitProc</B>:
<PRE>
typedef void Tcl_ExitProc(ClientData <I>clientData</I>);
</PRE>
The <I>clientData</I> parameter to <I>proc</I> is a copy of the <I>clientData</I> argument given to <B>Tcl_CreateExitHandler</B> or <B>Tcl_CreateThreadExitHandler</B> when the callback was created.  Typically, <I>clientData</I> points to a data structure containing application-specific information about what to do in <I>proc</I>. <P>
<B>Tcl_DeleteExitHandler</B> and <B>Tcl_DeleteThreadExitHandler</B> may be called to delete a previously-created exit handler.  It removes the handler indicated by <I>proc</I> and <I>clientData</I> so that no call to <I>proc</I> will be made.  If no such handler exists then <B>Tcl_DeleteExitHandler</B> or <B>Tcl_DeleteThreadExitHandler</B> does nothing. <P>
<P>
<B>Tcl_Finalize</B> and <B>Tcl_Exit</B> execute all registered exit handlers, in reverse order from the order in which they were registered. This matches the natural order in which extensions are loaded and unloaded; if extension <B>A</B> loads extension <B>B</B>, it usually unloads <B>B</B> before it itself is unloaded. If extension <B>A</B> registers its exit handlers before loading extension <B>B</B>, this ensures that any exit handlers for <B>B</B> will be executed before the exit handlers for <B>A</B>. <P>
<B>Tcl_Finalize</B> and <B>Tcl_Exit</B> call <B>Tcl_FinalizeThread</B>  and the thread exit handlers <I>after</I> the process-wide exit handlers.  This is because thread finalization shuts down the I/O channel system, so any attempt at I/O by the global exit handlers will vanish into the bitbucket. <P>
<P>
<H2>KEYWORDS</H2>
 callback, cleanup, dynamic loading, end application, exit, unloading, thread 
</BODY>
</HTML>
