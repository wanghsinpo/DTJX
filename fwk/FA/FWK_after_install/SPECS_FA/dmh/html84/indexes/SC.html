<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Ed Hume">
   <meta name="GENERATOR" content="Mozilla/4.77 [en] (Windows NT 5.0; U) [Netscape]">
   <title>The Scheduling Component</title>
</head>
<body>

<center>
<h2>
The Scheduling Component</h2></center>

<center><b>Licensed and Supported Software</b>
<br><b>(C) Copyright 2002, Hume Integration Software</b>
<br><b>All Rights Reserved</b></center>

<p><br>
<h3>
<a NAME="Introduction"></a>Introduction</h3>
The Scheduling Component is useable as a standalone application or as a
process in a distributed system for the purpose of managing and initiating
tasks in the future.&nbsp; The Scheduling Component can also be used as
a Tcl package extension in a custom application.
<p><img SRC="sc_gui.jpg" height=614 width=548>
<h3>
<a NAME="Feature"></a>Feature Summary</h3>

<ul>
<li>
A Graphical User Interface for managing one-shot and periodic task initiation.</li>

<li>
Excellent for periodic report initiation, or to trigger data collection.</li>

<li>
Can play .MP3 or .WAV files and function as a Musical Alarm Clock.&nbsp;
Use your notebook computer when traveling instead of a clock radio.</li>

<li>
Features a configurable clock view that is fun to display.</li>

<ul>
<li>
Size and color are configurable.</li>

<li>
12 or 24 hour format</li>

<li>
Date, or Seconds are optional</li>

<li>
The Local or UTC timezones may be displayed.</li>

<li>
The digits and text are optionally tilted.</li>
</ul>

<li>
Startup appearance is customizable using .Xdefaults or $HOME/.dmhrc resource
options.</li>

<li>
Dialog prompts and messages are read from <a href="../mann/msgcat.html">msgcat</a>
files, and can be Localized for International use.</li>

<li>
Displays updating list of scheduled tasks in pending execution order.</li>

<li>
Periodic tasks can be scheduled for weekly, hourly, daily, &lt;N> seconds,
&lt;N> minutes, &lt;N> hours, &lt;N> days, or &lt;N> weeks, up to a year
interval.</li>

<li>
Possible scheduled task actions:</li>

<ul>
<li>
Execute Tcl programming statements.</li>

<li>
Execute an external application.</li>

<li>
Play an MP3 or WAV file.</li>
</ul>
</ul>

<h3>
<a NAME="Installation"></a>Installation</h3>
Installation of the Scheduling Component (SC) requires the following software
be installed as well:
<ul>
<li>
The Hume Datahub SDK</li>

<li>
The [incr Tcl], [incr Tk], and Iwidgets packages</li>

<li>
The Hume Component Libraries which includes the Humelib and Dmhwidgets
packages</li>
</ul>
These software selections are available using the <b>setup</b> program
that installs the SC.
<h3>
<a NAME="Startup"></a>Startup</h3>
The SC can be used as a standalone application or as a process in a distributed
system.&nbsp; To start the SC as a separate process, use the <b>sc_run</b>
(or <b>sc_run.bat</b>) script file, or invoke the Windows Start menu program
item.&nbsp; The SC reads and writes to the file <b>sc_tasks.tab</b> when
running, so the SC needs to be executing with the working directory being
writeable by the person who starts the application.
<p>The user should have the environment variable LANG set to his current
Locale.&nbsp; If the value of LANG is not set, the SC sets it to en_US
so that English messages are presented to the user.&nbsp; The SC is configured
for other locales by defining message catalog files.&nbsp; See the <a href="../mann/msgcat.html">msgcat</a>
package document, and review the provided <b>en.msg</b> English message
catalog file.
<p>The SC can run in background or as a service.&nbsp; The GUI does not
need to be instantiated or used to have scheduled tasks execute.&nbsp;
Additional arguments on the sc_run command line are interpreted as Tcl
commands and executed at startup.&nbsp; One use of this capability is to
have the SC join a DMH message system group, so that it can send and receive
DMH messages while it runs.&nbsp; For example, if a DMH server is already
running, the SC can connect to it:
<blockquote><tt>datahub "set group=demo" eof &amp;</tt>
<br><tt>sc_run "mbx init demo" "mbx whenmsg SC_SQL mbx_SQL" &amp;</tt>
<br><tt>hubclient SC_SQL@demo &amp;</tt>
<br><tt>hubclient DATAHUB@demo &amp;</tt></blockquote>
Even if the GUI is not viewable, examining the <a href="#sc_tasks">sc_tasks</a>
table data remotely using a DMH connection can give the confidence that
the SC is executing properly, and that tasks are being invoked and rescheduled.
<p>The SC can also be installed and used as a Tcl <a href="../mann/package.html">package</a>
extension in your application.&nbsp; The SC package name is <b>HumeSC</b>.&nbsp;
To use the SC as a package, follow these steps:
<ul>
<ul>
<li>
Install the SC files in a directory under your Tcl runtime directories,
such as /usr/local/lib/sc.</li>

<li>
In your application execute:</li>

<ol>
<li>
<b><tt>package require HumeSC</tt></b></li>

<li>
<b><tt><a href="#sc_main">HumeSC::sc_main</a></tt></b></li>
</ol>
</ul>
</ul>

<h4>
Resources</h4>
On all platforms, at startup, the SC sources the file $env(HOME)/.dmhrc
if it exists.&nbsp; This feature gives you the ability to custom configure
the initial appearance of the SC clock.&nbsp; Here are model statements:
<blockquote><tt>option add *Lcdclock.Foreground turquoise userDefault</tt>
<br><tt>option add *Lcdclock.Background grey32 userDefault</tt>
<br><tt>option add *Lcdclock.Height 250 userDefault</tt>
<br><tt>option add *Lcdclock.Date 1</tt>
<br><tt>option add *Lcdclock.Hours 12</tt>
<br><tt>option add *Lcdclock.Seconds 0</tt>
<br><tt>option add *Lcdclock.Tilt 0</tt>
<br><tt>option add *Lcdclock.Utc 0</tt></blockquote>
In this same file, you can also add custom startup code.
<p>The resource customization can also be done on POSIX platforms using
the .Xdefaults file and a different syntax for X-Windows resources.&nbsp;
See the X-Windows documentation.
<h3>
<a NAME="Usage"></a>Usage</h3>
A freshly installed SC instance has some tasks defined, and&nbsp; .WAV
files included so that it can function as a chime sounding alarm clock.&nbsp;
One of key ideas is that scheduled tasks can be enabled or disabled.&nbsp;
When a task is disabled, all of the usual re-scheduling takes place, but
the task is not executed.&nbsp; For example, if you are using the SC for
a musical alarm clock, you can disable the wake-up music for a particular
day but keep the makeup task scheduled, and enable it in the future.
<p>The dialog used to configure tasks has the following appearance:
<p><img SRC="sc_gui_task.jpg" height=370 width=549>
<p>Hopefully, most of the expected usage is self-evident.&nbsp; Some notes:
<ul>
<li>
The next time due can be specified for your own timezone or for the UTC
timezone.</li>

<li>
The buttons with the downward arrows activate selection lists.</li>

<li>
One of the choices for "Period:" is <b>one-shot</b>.&nbsp; This choice
is used for aperiodic tasks.</li>

<li>
For some of the "Period:" choices such as <b>&lt;N> hours</b> you must
also enter a positive integer value for &lt;N>.</li>

<li>
For the task pathname or application arguments, you should use Unix style
slashes in pathname specifications.&nbsp; If multiple application arguments
are provided, you need to conform to the syntax of Tcl lists.</li>

<li>
Applications are executed in background using the Tcl <a href="../mann/exec.html">exec</a>
command with &amp; specified.</li>

<li>
You can execute new Tcl procedures in your tasks, by adding files to the
SC directory, rebuilding the tclIndex file, and restarting the SC.</li>

<li>
You can test execute your tasks from the main window, by selecting the
task and choosing the appropriate right-mouse click action, or pull-down
menu item.</li>
</ul>

<p><br>
<hr WIDTH="100%">
<br>
<hr WIDTH="100%">
<h3>
Internal&nbsp;<a NAME="API"></a>API</h3>
The more important procedures used internally by the SC are presented in
this section.&nbsp; These procedures could be used in new applications
to address custom requirements.&nbsp; These procedures are all coded in
the <a href="../mann/namespace.html">namespace</a> <b>HumeSC</b>.
<br>
<hr WIDTH="100%">
<br><a NAME="sc_gui"></a><b><font size=+1>sc_gui</font> - create the main
user interface window for the SC</b>
<p><b>Tcl Command Syntax</b>
<blockquote><b>sc_gui {w .sc_gui}</b></blockquote>
<b>Return Value</b>
<blockquote><b>None</b></blockquote>
<b>Description</b>
<blockquote>This command creates the main Graphical User Interface window
of the SC application.&nbsp; The window name used can be optionally specified.</blockquote>

<hr WIDTH="100%">
<br><a NAME="sc_load_data"></a><b><font size=+1>sc_load_data</font> - load
the task data from the file system and commence scheduling</b>
<p><b>Tcl Command Syntax</b>
<blockquote><b>sc_load_data</b></blockquote>
<b>Return Value</b>
<blockquote><b>None</b></blockquote>
<b>Description</b>
<blockquote>This command attempts to read the SQL table image file sc_tasks.tab
and then restart timers for the tasks found in the file.&nbsp; As the SC
runs, it updates the sc_tasks.tab file image.&nbsp; The file is plain text
SQL statements and may be manually edited before starting the SC.&nbsp;
Past due one-shot tasks are deleted from the table without execution.&nbsp;
Periodic tasks are moved to the next future time due.</blockquote>

<hr SIZE=0 WIDTH="100%">
<br><a NAME="sc_main"></a><b><font size=+1>sc_main </font>- Begin running
the SC</b>
<p><b>Tcl Command Syntax</b>
<blockquote><b>sc_main {want_gui 1}</b></blockquote>
<b>Return Value</b>
<blockquote><b>None</b></blockquote>
<b>Description</b>
<blockquote>This command is the main entry to running the SC.&nbsp; It
requests the additional Tcl packages needed by the software including <a href="complibs.html" target="cmds">Humelib</a>
and <a href="../mann/msgcat.html">msgcat</a>, and then executes, <b>sc_schema</b>,
<b>sc_load_data</b>,
and optionally <b>sc_gui</b>.&nbsp; The scheduling logic starts running
with the execution of <b>sc_load_data</b> so <b>sc_gui</b> does not need
to be called to have scheduled tasks execute.</blockquote>

<hr SIZE=0 WIDTH="100%">
<br><a NAME="sc_schema"></a><b><font size=+1>sc_schema </font>- Create
the SC SQL tables</b>
<p><b>Tcl Command Syntax</b>
<blockquote><b>sc_schema</b></blockquote>
<b>Return Value</b>
<blockquote><b>None</b></blockquote>
<b>Description</b>
<blockquote>This command creates the two in-memory tables described in
the next section.</blockquote>

<hr WIDTH="100%">
<br>
<hr WIDTH="100%">
<h3>
Table&nbsp;<a NAME="Schema"></a>Schema</h3>
These tables are created as <a href="../man1/datahub.html#CREATE">in-memory
tables</a> in the SC Tcl/Tk process.
<br>
<hr WIDTH="100%">
<br><a NAME="sc_task_type"></a><b>sc_task_type Table - Possible Task Types
for GUI Selection</b>
<br>&nbsp;
<br>&nbsp;
<table BORDER WIDTH="100%" >
<tr>
<td><b>Column&nbsp;</b>
<br><b>Name</b></td>

<td><b>Key</b></td>

<td><b>Type</b></td>

<td><b>Description</b></td>
</tr>

<tr>
<td>task_type</td>

<td>PK</td>

<td>varchar(20)</td>

<td>A keyword to indicate the task type. { <b>play_soundfile</b> | <b>exec
</b>|
<b>eval</b>
}</td>
</tr>

<tr>
<td>description</td>

<td>&nbsp;</td>

<td>varchar(40)</td>

<td>Description text shown to the user as a prompt, such as 'Play an MP3
or WAV audio file'</td>
</tr>

<tr>
<td>argprompt</td>

<td>&nbsp;</td>

<td>varchar(20)</td>

<td>The prompt to be displayed for the file system Browse.. button such
as 'Pathname:'</td>
</tr>
</table>

<p>
<hr WIDTH="100%">
<br><a NAME="sc_tasks"></a><b>sc_tasks Table - Configuration of Scheduled
Tasks</b>
<br>&nbsp;
<br>&nbsp;
<table BORDER WIDTH="100%" >
<tr>
<td><b>Column&nbsp;</b>
<br><b>Name</b></td>

<td><b>Key</b></td>

<td><b>Type</b></td>

<td><b>Description</b></td>
</tr>

<tr>
<td>utctime_due</td>

<td>PCK</td>

<td>varchar(19)</td>

<td>A timestamp for the task due time in the UTC timezone. (<a href="../mann/localtime.html">localtime
10</a>)</td>
</tr>

<tr>
<td>timer_id</td>

<td>PCK</td>

<td>varchar(20)</td>

<td>A unique name for an <a href="../mann/ep_timer.html">ep_timer</a> instance
used to schedule the task.</td>
</tr>

<tr>
<td>localtime_due</td>

<td>&nbsp;</td>

<td>varchar(19)</td>

<td>A timestamp for the task due time in the local timezone. (<a href="../mann/localtime.html">localtime
9</a>)</td>
</tr>

<tr>
<td>period</td>

<td>&nbsp;</td>

<td>varchar(20)</td>

<td>The period interval for periodic tasks.&nbsp; Blank or one-shot for
aperiodic tasks.&nbsp; Should be equal to a year or less duration.&nbsp;
{ <b><i>N</i> [second[s]] | <i>N</i> day[s] | <i>N</i> week[s] | weekly
| hourly | daily | <i>N</i> hour[s] | <i>N</i> minute[s]</b> }</td>
</tr>

<tr>
<td>is_enabled</td>

<td>&nbsp;</td>

<td>integer</td>

<td>Used as a boolean to determine whether the task is executed when the
current time becomes the time due.</td>
</tr>

<tr>
<td>is_utc_schedule</td>

<td>&nbsp;</td>

<td>integer</td>

<td>Used as a boolean to determine whether the task is scheduled in the
local timezone or in the UTC timezone.&nbsp; The task configuration GUI
will present the task data and pre-select the timezone checkbox accordingly.&nbsp;
Also, for periodic tasks that are scheduled in the local timezone where
the period is an integer number of days, the scheduling logic will adjust
the task time across Daylight Saving Time clock shifts so that the task
occurs at the same local hour of day, if possible.&nbsp; Periodic tasks
that are scheduled in the UTC timezone are not adjusted for Daylight Saving
Time clock shifts.</td>
</tr>

<tr>
<td>description</td>

<td>&nbsp;</td>

<td>varchar(40)</td>

<td>A description for the scheduled task provided by the user.</td>
</tr>

<tr>
<td>task</td>

<td>&nbsp;</td>

<td>varchar(2000)</td>

<td>A two element list of the task type and its arguments.&nbsp; The arguments
to the task depend on the task type.&nbsp;</td>
</tr>
</table>

<p>
<hr WIDTH="100%">
<br>
<hr WIDTH="100%">
<h3>
Document&nbsp;<a NAME="Version"></a>Version</h3>
Date of last revision: $Date: 2004/03/02 17:04:39 $
<p>This document covers the Hume Integration Software developed Scheduling
Component which is available for the Tcl 8.3/Tk 8.3 environment on the
Windows 2000/NT and UNIX/POSIX platforms.
</body>
</html>
